<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="application-name" content="<em>ERPione</em>">
<meta name="description" content="<em>ERPione</em> TODO">
<meta name="author" content="gematik GmbH">
<meta name="copyright" content="2025 by gematik GmbH, Berlin">
<link rel="icon" type="image/x-icon" href="./images/erpione.ico">
<title>ERPione</title>
<style>
/*
 * ${GEMATIK_COPYRIGHT_STATEMENT}
 */

@import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');

/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */

@import url(https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css); /* Default asciidoc style framework - important */

/* CUSTOMISATIONS */
/* Change the values in root for quick customisation. If you want even more fine grain... venture further. */

:root {
    --maincolor: #FFFFFF;
    --primarycolor: #000E52;
    --secondarycolor: #000E52;
    --tertiarycolor: #225494;
}

body {
    font-family: "Verdana", sans-serif;
    font-size: 11pt;
    text-align: justify;
}

/* Text styles */
h1 {
    color: var(--primarycolor);
    font-weight: bold;
    text-align: center;
}

#header {
    padding: 20rem 0;
    background-position: top;
    background-repeat: no-repeat;
    background-image: url("media/title_white.plain.svg");
    height: 80rem;
}

/* TODO Anne to be kept locally */
#header h1 {
    background-image: url("media/tiger-mono-picto-plain.svg");
    background-size: 150px;
    background-repeat: no-repeat;
    background-position: 120px bottom;
    padding-left: 10rem;
    line-height: 350%;
    font-size: 327%;
}

#header .details {
    text-align: center;
    display: block;
    padding-left: 120px;
    border: 0;
    margin-top: -40px;
}
/* end of to be kept locally */

h2 {
    color: var(--secondarycolor);
    font-weight: bold;
}

h3, h4, h5, h6 {
    color: var(--tertiarycolor);
    font-weight: bold;
}

h3 {
    margin-top: 5rem;
}

/* code blocks */
.listingblock > .content > pre.CodeRay, code, pre {
    font-family: "Fira Code";
    font-size: 82%;
}

.listingblock > .content > pre.CodeRay {
    background: #fafafa !important;
    border: 1px solid #ccc;
    border-radius: 0.5rem;
}


/* captions for all kinds of blocks
.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title
*/
.title {
    font-family: "Verdana" !important;
    font-style: italic !important;
    color: #000000 !important;
}

/* links */
a {
    color: #00766e;
}

#toctitle {
    color: var(--primarycolor);
}

#toc, #toc a {
    color: var(--secondarycolor);
    line-height: 175%;
}

/* Table styles */
th {
    font-family: "Verdana", sans-serif
}

/* Responsiveness fixes */
video {
    max-width: 100%;
}

@media all and (max-width: 600px) {
    table {
        width: 55vw;
        font-size: 3vw;
    }
}


</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<link rel="license" href="https://www.apache.org/licenses/LICENSE-2.0.txt" title="Apache License, Version 2.0">

<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
    .tocify-header {
        font-style: italic;
    }

    .tocify-subheader {
        font-style: normal;
        font-size: 90%;
    }

    .tocify ul {
        margin: 0;
    }

    .tocify-focus {
        color: #7a2518;
        background-color: rgba(0, 0, 0, 0.1);
    }

    .tocify-focus > a {
        color: #7a2518;
    }
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1><em>ERPione</em></h1>
<div class="details">
<span id="author" class="author">gematik GmbH</span><br>
<span id="revnumber">version 0.9.1,</span>
<span id="revdate">2025-05-16</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_scope">Scope</a>
<ul class="sectlevel2">
<li><a href="#_eponym">Eponym</a></li>
<li><a href="#_architecture">Architecture</a>
<ul class="sectlevel3">
<li><a href="#_backend">Backend</a></li>
<li><a href="#_frontend">Frontend</a></li>
<li><a href="#_proxy">Proxy</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_erpione_cli">ERPione CLI</a>
<ul class="sectlevel2">
<li><a href="#_installation">Installation</a>
<ul class="sectlevel3">
<li><a href="#docker_usage">Docker</a></li>
<li><a href="#native_usage">Nativ</a></li>
<li><a href="#py_source_usage">From source</a></li>
</ul>
</li>
<li><a href="#_curl">cURL</a></li>
<li><a href="#_configuration">Configuration</a>
<ul class="sectlevel3">
<li><a href="#api_key_env">API-Key</a></li>
<li><a href="#default_env">Default Environment</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_use_cases">Use cases</a>
<ul class="sectlevel2">
<li><a href="#_help">Help</a></li>
<li><a href="#_issue_prescriptions">Issue prescriptions</a>
<ul class="sectlevel3">
<li><a href="#_data_matrix_codes">Data Matrix Codes</a></li>
</ul>
</li>
<li><a href="#_accept_prescriptions">Accept prescriptions</a></li>
<li><a href="#_dispense_prescriptions">Dispense prescriptions</a></li>
<li><a href="#_close_prescriptions">Close prescriptions</a></li>
<li><a href="#_abort_prescriptions">Abort prescriptions</a></li>
<li><a href="#_create_charge_items">Create charge items</a></li>
<li><a href="#_change_charge_items">Change charge items</a></li>
<li><a href="#_service_information">Service information</a></li>
</ul>
</li>
<li><a href="#_release_notes">Appendix A: Release Notes</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="./images/erpione-logo.png" alt="erpione logo" width="30%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scope"><a class="anchor" href="#_scope"></a>Scope</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a national competence center for digital health, gematik GmbH provides a lot of services and applications for testing the telematics infrastructure (TI) services. <em>ERPione</em> is one of them. It is a software solution that enables the convenient creation of e-prescriptions in a test environment. It is designed to be used by developers and testers who want to test the integration of e-prescriptions into their applications.</p>
</div>
<div class="sect2">
<h3 id="_eponym"><a class="anchor" href="#_eponym"></a>Eponym</h3>
<div class="paragraph">
<p>The name <em>ERPione</em> is a combination of ERP - short for e-prescription (<a href="https://www.gematik.de/anwendungen/e-rezept">E-Rezept | Gematik</a>) - and the Greek goddess Epione. As the goddess of pain relief and the mother of Hygieia, the patron saint of pharmacists, she is an ideal namesake.</p>
</div>
</div>
<div class="sect2">
<h3 id="_architecture"><a class="anchor" href="#_architecture"></a>Architecture</h3>
<div class="paragraph">
<p>The architecture of <em>ERPione</em> follows a modular client-server approach, separating responsibilities between backend, frontend, and proxy components to ensure scalability, maintainability, and clear abstraction of technical details.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/erpione_setup.png" alt="erpione setup" width="100%">
</div>
</div>
<div class="sect3">
<h4 id="_backend"><a class="anchor" href="#_backend"></a>Backend</h4>
<div class="paragraph">
<p>The backend handles all tasks such as communicating with the TI, processing <a href="https://www.hl7.org/fhir/">FHIR</a> or creating cryptographic signatures.</p>
</div>
</div>
<div class="sect3">
<h4 id="_frontend"><a class="anchor" href="#_frontend"></a>Frontend</h4>
<div class="paragraph">
<p>The frontend itself is relatively lean (<a href="https://de.wikipedia.org/wiki/Thin_Client">Thin Client</a>). It therefore contains little to no domain knowledge, e.g. about FHIR or the e-prescription itself, but merely serves as an intermediary between the user and the backend service.</p>
</div>
</div>
<div class="sect3">
<h4 id="_proxy"><a class="anchor" href="#_proxy"></a>Proxy</h4>
<div class="paragraph">
<p>The proxy is almost transparent to the user, but performs two essential tasks: routing to the appropriate environments and access control to the actual service via <a href="https://en.wikipedia.org/wiki/API_key">API keys</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_erpione_cli"><a class="anchor" href="#_erpione_cli"></a>ERPione CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>ERPione</em> CLI is a command line interface that allows you to interact with the <em>ERPione</em> application from the terminal. It provides a set of commands for managing and configuring the application, as well as for performing various tasks.</p>
</div>
<div class="sect2">
<h3 id="_installation"><a class="anchor" href="#_installation"></a>Installation</h3>
<div class="paragraph">
<p>The <em>ERPione</em> can be used in three variants. In the simplest case, <em>ERPione</em> can be used directly as a <a href="#native_usage">native</a> and executable application for the respective operating system.</p>
</div>
<div class="paragraph">
<p>The container variant uses <a href="https://www.docker.com/">Docker</a> for execution and also offers additional features such as a <a href="https://de.wikipedia.org/wiki/Manpage">manpage</a>, the <a href="https://ohmyz.sh/">oh-my-zsh</a> and the integration of <a href="https://hub.docker.com/r/gematik1/erp-cli-fhir">erp-cli-fhir</a>.</p>
</div>
<div class="paragraph">
<p>The last variant for execution directly via the source files is possible, but is only recommended for developers and enthusiasts.</p>
</div>
<div class="paragraph">
<p>Translated with www.DeepL.com/Translator (free version)</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you have already installed <a href="https://www.docker.com/">Docker</a>, the <a href="#docker_usage">container variant</a> should be your preferred choice.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="docker_usage"><a class="anchor" href="#docker_usage"></a>Docker</h4>
<div class="paragraph">
<p>The <em>ERPione</em> can be loaded directly as a Docker image from <a href="https://hub.docker.com/r/gematik1/erpione">DockerHub</a> with <a href="https://docs.docker.com/engine/reference/commandline/pull/">docker pull</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">docker pull gematik1/erpione</code></pre>
</div>
</div>
<div class="paragraph">
<p>The image can now be started with the following command using <a href="https://docs.docker.com/engine/reference/commandline/run/">docker run</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">docker run -it --name <em>ERPione</em> \
      --env ERPIONE_API_KEY=$ERPIONE_API_KEY \
      -v $FULL_HOST_PATH:/home/gematik/shared \
      gematik1/erpione</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>With <code>-it</code> (abbreviated for <code>--interactive</code> and <code>--tty</code>), the container is started in an interactive TTY session and the user lands directly in the container.</p>
</li>
<li>
<p>The container name <code><em>ERPione</em></code> is freely selectable</p>
</li>
<li>
<p>With <code>--env ERPIONE_API_KEY=$ERPIONE_API_KEY</code> the API key is stored in the container as an environment variable. Here, <code>$ERPIONE_API_KEY</code> must be replaced with the actual API key if the environment variable is <strong>not</strong> stored on the host computer</p>
</li>
<li>
<p>With <code>-v $FULL_HOST_PATH:/home/gematik</code> a <a href="https://docs.docker.com/storage/volumes/">Volume</a> is included in the container (quasi a shared folder between the container and the host computer) to enable the exchange of files between the container and the host computer. If this is not required, this argument can also be omitted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>-it</code> switch means that the container is <strong>not</strong> shut down when it is exited.
As long as the container is running, you can always dial into the container again using <a href="https://docs.docker.com/engine/reference/commandline/exec/">docker exec</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">docker exec -ti <em>ERPione</em> /bin/zsh</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>With <code>-it</code> (abbreviated for <code>--interactive</code> and <code>--tty</code>), the container is started in an interactive TTY session and the user lands directly in the container.</p>
</li>
<li>
<p>The container name <code><em>ERPione</em></code> that was previously selected for `docker run</p>
</li>
<li>
<p>The last argument <code>/bin/zsh</code> specifies which shell is to be used.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="native_usage"><a class="anchor" href="#native_usage"></a>Nativ</h4>
<div class="paragraph">
<p>In principle, no special commissioning is necessary. <em>ERPione</em> can be used directly as an executable application without any installation. However, for the user&#8217;s convenience, it is recommended to initially set up the <a href="#api_key_env">API-Key in the environment variables</a>.</p>
</div>
<div class="paragraph">
<p>The executable applications must be generated separately for each operating system. Currently, <em>ERPione</em> is provided native executable for the following operating systems:</p>
</div>
<div class="paragraph">
<p>Translated with www.DeepL.com/Translator (free version)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Windows</p>
</li>
<li>
<p>Linux</p>
</li>
<li>
<p>macOS</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="py_source_usage"><a class="anchor" href="#py_source_usage"></a>From source</h4>
<div class="paragraph">
<p>This variant is only recommended for developers and Python enthusiasts and requires the Python toolchain for execution</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.python.org/downloads/">Python 3.11</a></p>
</li>
<li>
<p><a href="https://pypi.org/project/pip/">pip</a></p>
</li>
<li>
<p>ideally <a href="https://docs.python.org/3/library/venv.html#module-venv">venv</a> or <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <em>virtual environment</em> can be created and activated with the following call from the main directory of <em>ERPione</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">python -m venv <em>ERPione</em>_venv

source <em>ERPione</em>_venv/bin/activate</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dependencies can then be installed within the <em>virtual environment</em> using pip:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">pip install -r requirements.txt</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_curl"><a class="anchor" href="#_curl"></a>cURL</h3>
<div class="paragraph">
<p>cURL is a command-line tool for transferring data using various network protocols. It is widely used for testing APIs and web services. In the context of <em>ERPione</em>, cURL can be used to interact with the RESTful API endpoints provided by the application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h3>
<div class="sect3">
<h4 id="api_key_env"><a class="anchor" href="#api_key_env"></a>API-Key</h4>
<div class="paragraph">
<p>The API key is required for each <em>ERPione</em> request. To avoid having to specify it for each operation, it is possible to store the API key permanently as <a href="https://de.wikipedia.org/wiki/Umgebungsvariable">environment variable</a>.</p>
</div>
<div class="paragraph">
<p>To do this, the API key must be stored under the <code>ERPIONE_API_KEY</code> environment variable in the operating system. This procedure differs from operating system to operating system. There are numerous instructions on the Internet, e.g., for <a href="https://phoenixnap.com/kb/windows-set-environment-variable">Windows</a> and <a href="https://www.serverlab.ca/tutorials/linux/administration-linux/how-to-set-environment-variables-in-linux/">Linux</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="default_env"><a class="anchor" href="#default_env"></a>Default Environment</h4>
<div class="paragraph">
<p>The environment (TU, RU, RU-DEV) can be specified separately for each request using the <code>--env</code> switch.
To avoid having to specify this switch for each individual call, a default environment can be defined using the environment variable <code>ERPIONE_ENV</code>. The default environment can then be overridden with `--env'.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_cases"><a class="anchor" href="#_use_cases"></a>Use cases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>ERPione</em> CLI is a command line interface that allows you to interact with the <em>ERPione</em> application from the terminal. It provides a set of commands for managing and configuring the application, as well as for performing various tasks.</p>
</div>
<div class="sect2">
<h3 id="_help"><a class="anchor" href="#_help"></a>Help</h3>
<div class="paragraph">
<p>The <code>-h</code> (or <code>--help</code>) argument is the first port of call to get initial help on the CLI arguments.</p>
</div>
<div class="paragraph">
<p>For example, you can use the following help to get an overview of the available subcommands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione --help</code></pre>
</div>
</div>
<div class="paragraph">
<p>The appropriate help for a particular subcommand is then displayed as follows:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">structure</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione SUBCOMMAND --help</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">example</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione prescribe --help
usage: erpione prescribe [-h] [-e {tu,ru,rudev}] [-s SERVER] [--api-key API_KEY | --api-key-file API_FILE] [--actor ACTOR] [--dmc] bundles_path

positional arguments:
  bundles_path          Path to KBV-Bundles to be prescribed

options:
  -h, --help            show this help message and exit
  -e {tu,ru,rudev}, --env {tu,ru,rudev}
                        Specification the Environment for this call. This argument will overwrite the default environment configured via ERPIONE_ENV
  -s SERVER, --server SERVER
                        The URL of the PrimSys-REST server (default: https://erpps-test.dev.gematik.solutions/)
  --api-key API_KEY     API-Key for accessing the service
  --api-key-file API_FILE
                        Path to file where the API-Key is stored
  --actor ACTOR         ID or name of the actor
  --dmc                 Download Data-Matrix-Codes</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>Most subcommands have a common base of switches for the <em>ERPione</em>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. common arguments</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">short</th>
<th class="tableblock halign-left valign-top">long</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--env</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selects the appropriate TI environment. This switch overrides the <a href="#default_env">default_environment</a>. If the environment is not specified by either <code>-e</code> or <a href="#default_env">standard_environment</a>, then the default on the erpione-proxy is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default corresponds to the internal hosting within gematik and generally does not need to be changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--api-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be used to override the <a href="#api_key_env">environment variable</a> or set one if no <a href="#api_key_env">environment variable</a> is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--api-key-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be used to overwrite the <a href="#api_key_env">environment variable</a> with an API key from a file, or set one if no <a href="#api_key_env">environment variable</a> is set.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_issue_prescriptions"><a class="anchor" href="#_issue_prescriptions"></a>Issue prescriptions</h3>
<div class="paragraph">
<p>The following command can be used to issue e-prescriptions directly from a KBV bundle template:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">erpione</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione prescribe ~/examples/gkv_bundle_01.xml</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">curl</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">curl -H "apikey: $ERPIONE_API_KEY" \
  -H "Content-Type: application/xml" \
  https://erpps-test.dev.gematik.solutions/ru/doc/6a7f66bc2bb0f4cd76deaa260abbb484/xml/prescribe \
  -d "@~/examples/gkv_bundle_01.xml" | jq</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>In some cases, it is necessary to issue many prescriptions at once. This would be very tedious to do with curl, or would have to be done with a script. The <em>ERPione</em> provides a built-in mechanism for this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione prescribe ~/examples/</code></pre>
</div>
</div>
<div class="paragraph">
<p>You just have to specify the directory instead of a specific file. The <em>ERPione</em> will iterate through the given directory and create a prescription for each template it finds.</p>
</div>
<div class="sect3">
<h4 id="_data_matrix_codes"><a class="anchor" href="#_data_matrix_codes"></a>Data Matrix Codes</h4>
<div class="paragraph">
<p>If a Data Matrix Code (DMC) is required for the e-prescription output, the <code>--dmc</code> switch can be used. This means that the DMC is also downloaded for each e-prescription and stored as a PNG image file in the output directory with the naming scheme <code>dmc_&lt;PRESCRIPTION_ID&gt;.png</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione prescribe --dmc ~/examples/gkv_bundle_01.xml</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_accept_prescriptions"><a class="anchor" href="#_accept_prescriptions"></a>Accept prescriptions</h3>
<div class="paragraph">
<p>E-prescriptions issued via <em>ERPione</em> can be accepted as a pharmacy with the following command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">erpione</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione accept --taskid [TID]</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">curl</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">curl -X POST \
  -H "apikey: $ERPIONE_API_KEY" \
  https://erpps-test.dev.gematik.solutions/ru/pharm/[PHARMACY_ID]/accept?taskId=[TID]&ac=[AC] | jq</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>--accesscode</code> parameter is optional in this case because <em>ERPione</em> already knows it.
The situation is different for e-prescriptions that were not issued via <em>ERPione</em> or for older e-prescriptions that are no longer in the internal memory of <em>ERPione</em>. In this case, the AccessCode must be specified explicitly, similar to the curl approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione accept -t [TID] --accesscode [AC]</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Accepted e-prescriptions are set to <code>in process</code> status in the FD and are <em>"reserved"</em> for that pharmacy. More precisely, <em>"reserved"</em> for all pharmacies that know the generated <strong>Secret</strong>.</p>
</div>
<div class="paragraph">
<p><span class="red">Forgotten secrets can be a problem because such e-prescriptions cannot be processed further and are automatically removed from the FD after 90 days.</span></p>
</div>
<div class="paragraph">
<p>To prevent this, the e-prescriptions should be further processed (e.g., dispensed or deleted) after acceptance if possible</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dispense_prescriptions"><a class="anchor" href="#_dispense_prescriptions"></a>Dispense prescriptions</h3>
<div class="paragraph">
<p>To dispense an e-prescription, the <code>accept</code> command must first be executed so that the FD can set the e-prescription to the ìn-progress` status and generate a secret.
The e-prescription can then be dispensed using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione dispense -t [TID]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As with <code>accept</code>, the secret is only required for <em>externally</em> created or accepted e-prescriptions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to specify one or more substitute medicines at the time of dispensing. The <code>--body-file</code> option can be used to submit a JSON file containing the replacement drug.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione dispense -t [TID] --body-file ~/examples/dispense_body.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The content of <code>dispense_body.json</code> could be something like the following, if more than one replacement drug is dispensed for this prescription</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PZN</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">category</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">standardSize</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NB</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">supplyForm</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">AMP</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">amount</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">pzn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">09385450</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Vitadol Gold Beutel 1000 mg</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">batch</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">lotNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">123123</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">expiryDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">26/02/2024</span><span class="delimiter">&quot;</span></span>
    }
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PZN</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">category</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">standardSize</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NB</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">supplyForm</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">AMP</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">amount</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">pzn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">17975846</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Cbd 10 Cannbio Gold Edition 10 ml</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">batch</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">lotNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">123123</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">expiryDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">26/02/2024</span><span class="delimiter">&quot;</span></span>
    }
  }
]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_close_prescriptions"><a class="anchor" href="#_close_prescriptions"></a>Close prescriptions</h3>
<div class="paragraph">
<p>The <code>close</code> command is used to finally close an e-prescription. As with the <code>dispense</code> command, a previous <code>accept</code> is mandatory. Before <code>close</code> a <code>dispense</code> is possible but not mandatory.</p>
</div>
<div class="paragraph">
<p>The <code>close</code> command has the same interface as the <code>dispense</code> command. The only difference here is that the e-prescription is not closed with the <code>dispense</code> and therefore remains in the <code>in-progress</code> state.</p>
</div>
</div>
<div class="sect2">
<h3 id="_abort_prescriptions"><a class="anchor" href="#_abort_prescriptions"></a>Abort prescriptions</h3>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">erpione</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione abort -t [TID]</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">curl</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">curl -X DELETE \
  -H "apikey: $ERPIONE_API_KEY" \
  https://erpps-test.dev.gematik.solutions/ru/pharm/[PHARMACY_ID]/abort?taskId=[TID]&ac=[AC]?secret=[SECRET] | jq</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The AccessCode <code>[AC]</code> and Secret <code>[SECRET]</code> are only required for <em>externally</em> generated e-prescriptions, as with <code>accept</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_create_charge_items"><a class="anchor" href="#_create_charge_items"></a>Create charge items</h3>
<div class="paragraph">
<p>Das Erstellen bzw. das Ändern der PKV-Abrechnungsinformationen wird über das Sub-Kommando <code>chargeitem</code> abgewickelt.
Der Inhalt der PKV-Abrechnungsinformationen wird dabei in einem JSON-File definiert und an das Sub-Kommando übergeben. Sowohl für <code>create</code> als auch <code>change</code> ist die Struktur des JSON-Files identisch und entspricht der Struktur die bereits im Szenario-Player verwendet wird:</p>
</div>
<div class="paragraph">
<p>The <code>chargeitem</code> subcommand is used to create or modify the charge item information.
The content of the charge item information is defined in a JSON file and passed to the subcommand. The structure of the JSON file is identical for both create and modify, and is the same as the structure already used in the Scenario Player:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">currency</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EUR</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">vatRate</span><span class="delimiter">&quot;</span></span>: <span class="float">12.9</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">priceComponents</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">category</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ZUZAHLUNG</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">informational</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">insurantCost</span><span class="delimiter">&quot;</span></span>: <span class="float">12.3</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">totalCost</span><span class="delimiter">&quot;</span></span>: <span class="float">75.5</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">pzn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">12345678</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">category</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ZUZAHLUNG</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">informational</span><span class="delimiter">&quot;</span></span>
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a ChargeItem, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione chargeitem create --taskid [TASK_ID] [path/to/payload.json]

erpione chargeitem create -t 200.000.002.175.581.70 ./resources/my_examples/chargeitem_payload.json</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_change_charge_items"><a class="anchor" href="#_change_charge_items"></a>Change charge items</h3>
<div class="paragraph">
<p>Charge items that have been set initially can be changed later at the request of the insured person.
To change an existing charge item, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione chargeitem change --taskid [TID] --accesscode [AC] [path/to/payload.json]

erpione chargeitem change -t 200.000.002.175.581.70 \
      -a 9ea09db15e04fe9b1613cd0a338b812c728b355d672d9af8e54b7596e9098fa8 \
      ./resources/my_examples/chargeitem_payload.json</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this use case, the AccessCode has the same structure and the same name as the AccessCode of a prescription. However, the two values are different and should not be confused.</p>
</div>
<div class="paragraph">
<p>The AccessCode for the ChargeItem is regenerated by the FD when <code>create</code> and <code>change</code> and must be called up again by the FdV after each change.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_service_information"><a class="anchor" href="#_service_information"></a>Service information</h3>
<div class="paragraph">
<p>To get information about the service, you can use the following call:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">erpione</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione info</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">curl</dt>
<dd>
<div class="listingblock primary">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">curl -H "apikey: $ERPIONE_API_KEY" https://erpps-test.dev.gematik.solutions/ru/info | jq</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition, the active <strong>Actors</strong> can be accessed with the following call:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">erpione</dt>
<dd>
<div class="listingblock secondary">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">erpione actors</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">curl</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">curl -H "apikey: $ERPIONE_API_KEY" https://erpps-test.dev.gematik.solutions/actors | jq</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_release_notes"><a class="anchor" href="#_release_notes"></a>Appendix A: Release Notes</h2>
<div class="sectionbody">
<h3 id="_release_0_9_0" class="discrete">Release 0.9.0</h3>
<div class="paragraph">
<p>Initial public release</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.9.1<br>
</div>
</div>
</body>
</html>